import telebot
from telebot import types
import os

# üîë –¢–æ–∫–µ–Ω –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è Render (Environment)
BOT_TOKEN = os.getenv("BOT_TOKEN")

# ‚ö†Ô∏è –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ ‚Äî –º–æ–∂–µ—à—å —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ –∏ –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤—Ä—É—á–Ω—É—é
# BOT_TOKEN = "8046565380:AAHpWTI-A6juTxj7DZs4I66g2CmnDn1CC1M"

bot = telebot.TeleBot(BOT_TOKEN)

# üîπ –í–æ–ø—Ä–æ—Å—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
questions = [
    {
        "q": "–ß—Ç–æ —Ç–µ–±–µ –±–æ–ª—å—à–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?",
        "options": {"üé® –†–∏—Å–æ–≤–∞—Ç—å –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å": "design", "üíª –†–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏ –∏ –∫–æ–¥–∏—Ç—å": "it", "üí¨ –û–±—â–∞—Ç—å—Å—è –∏ –ø–æ–º–æ–≥–∞—Ç—å –ª—é–¥—è–º": "psy"}
    },
    {
        "q": "–ö–∞–∫–æ–π –ø—Ä–µ–¥–º–µ—Ç —Ç–µ–±–µ –±–ª–∏–∂–µ?",
        "options": {"üñå –ò–∑–æ": "design", "üßÆ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞": "it", "üìò –û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ": "psy"}
    },
    {
        "q": "–ß—Ç–æ —Ç—ã –¥–µ–ª–∞–µ—à—å –≤ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è?",
        "options": {"üì∑ –†–µ–¥–∞–∫—Ç–∏—Ä—É—é —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ": "design", "üéÆ –ò–≥—Ä–∞—é –∏–ª–∏ —Å–æ–∑–¥–∞—é —á—Ç–æ-—Ç–æ –Ω–∞ –∫–æ–º–ø–µ": "it", "üë• –°–æ–≤–µ—Ç—É—é—Å—å —Å –¥—Ä—É–∑—å—è–º–∏": "psy"}
    },
    {
        "q": "–ß—Ç–æ —Ç–µ–±–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ?",
        "options": {"üé≠ –¶–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç—ã, —Ñ–æ—Ä–º—ã": "design", "‚öôÔ∏è –ö–æ–¥—ã, –ø—Ä–æ–≥—Ä–∞–º–º—ã, –ª–æ–≥–∏–∫–∞": "it", "‚ù§Ô∏è –ß—É–≤—Å—Ç–≤–∞, –ª—é–¥–∏, –æ—Ç–Ω–æ—à–µ–Ω–∏—è": "psy"}
    },
    {
        "q": "–ß—Ç–æ –±—ã —Ç—ã –≤—ã–±—Ä–∞–ª?",
        "options": {"üñº –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç–µ—Ä": "design", "üïπ –ù–∞–ø–∏—Å–∞—Ç—å –∏–≥—Ä—É": "it", "üìä –ü—Ä–æ–≤–µ—Å—Ç–∏ –æ–ø—Ä–æ—Å": "psy"}
    },
    {
        "q": "–ß—Ç–æ —Ç–µ–±–µ –¥–∞—ë—Ç—Å—è –ª–µ–≥—á–µ?",
        "options": {"‚úèÔ∏è –ü—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ": "design", "üî¢ –†–µ—à–∞—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏": "it", "üó£ –û–±—ä—è—Å–Ω—è—Ç—å –¥—Ä—É–≥–∏–º": "psy"}
    },
    {
        "q": "–ö–∞–∫—É—é –ø—Ä–æ—Ñ–µ—Å—Å–∏—é –≤—ã–±—Ä–∞–ª –±—ã?",
        "options": {"üë®‚Äçüé® –î–∏–∑–∞–π–Ω–µ—Ä": "design", "üë®‚Äçüíª –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç": "it", "üë©‚Äçüè´ –ü—Å–∏—Ö–æ–ª–æ–≥": "psy"}
    },
    {
        "q": "–ß—Ç–æ –≤–∞–∂–Ω–µ–µ –≤ —Ä–∞–±–æ—Ç–µ?",
        "options": {"‚ú® –ö—Ä–∞—Å–æ—Ç–∞ –∏ —Å—Ç–∏–ª—å": "design", "üìè –¢–æ—á–Ω–æ—Å—Ç—å –∏ –ª–æ–≥–∏–∫–∞": "it", "ü§ù –ü–æ–Ω–∏–º–∞–Ω–∏–µ –ª—é–¥–µ–π": "psy"}
    },
    {
        "q": "–ö–∞–∫ —Ç—ã –æ—Ç–Ω–æ—Å–∏—à—å—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ?",
        "options": {"üé® –•–æ—á—É –¥–µ–ª–∞—Ç—å –∫—Ä–∞—Å–∏–≤–æ –≤–º–µ—Å—Ç–µ": "design", "üöÄ –ì–ª–∞–≤–Ω–æ–µ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç": "it", "üí¨ –õ—é–±–ª—é –ø–æ–º–æ–≥–∞—Ç—å –∫–æ–ª–ª–µ–≥–∞–º": "psy"}
    },
    {
        "q": "–ö–µ–º —Ç—ã –≤–∏–¥–∏—à—å —Å–µ–±—è —á–µ—Ä–µ–∑ 5 –ª–µ—Ç?",
        "options": {"üé® –î–∏–∑–∞–π–Ω–µ—Ä–æ–º": "design", "üíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º": "it", "üß† –ü—Å–∏—Ö–æ–ª–æ–≥–æ–º": "psy"}
    }
]

# üîπ –•—Ä–∞–Ω–∏–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
user_data = {}

@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(
        message.chat.id,
        "üëã –ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –º–∏–Ω–∏-–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è —Ç–µ–±–µ –ø–æ–¥—Ö–æ–¥–∏—Ç.\n\n–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏ —Å–≤–æ—ë *–ò–º—è –∏ –§–∞–º–∏–ª–∏—é*:",
        parse_mode="Markdown"
    )
    user_data[message.chat.id] = {"step": "name", "scores": {"design": 0, "it": 0, "psy": 0}}

@bot.message_handler(func=lambda m: m.chat.id in user_data)
def handle_message(message):
    user = user_data[message.chat.id]
    step = user["step"]

    if step == "name":
        user["name"] = message.text.strip()
        user["step"] = "group"
        bot.send_message(message.chat.id, "üìò –û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–∏ –Ω–æ–º–µ—Ä —Å–≤–æ–µ–π –≥—Ä—É–ø–ø—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: *3-25*):", parse_mode="Markdown")

    elif step == "group":
        user["group"] = message.text.strip()
        user["step"] = 0
        bot.send_message(message.chat.id, f"‚úÖ –°–ø–∞—Å–∏–±–æ, {user['name']} –∏–∑ –≥—Ä—É–ø–ø—ã {user['group']}!\n\n–¢–µ–ø–µ—Ä—å –Ω–∞—á–Ω—ë–º –≤–∏–∫—Ç–æ—Ä–∏–Ω—É üéØ")
        ask_question(message.chat.id)

    elif isinstance(step, int):
        if step < len(questions):
            q = questions[step]
            answer = message.text
            if answer in q["options"]:
                sphere = q["options"][answer]
                user["scores"][sphere] += 1
                user["step"] += 1
                ask_question(message.chat.id)
            else:
                bot.send_message(message.chat.id, "‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.")
        else:
            finish_quiz(message.chat.id)

def ask_question(chat_id):
    user = user_data[chat_id]
    step = user["step"]

    if step < len(questions):
        q = questions[step]
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True)
        for option in q["options"].keys():
            markup.add(option)
        bot.send_message(chat_id, f"‚ùì {q['q']}", reply_markup=markup)
    else:
        finish_quiz(chat_id)

def finish_quiz(chat_id):
    user = user_data[chat_id]
    scores = user["scores"]
    best = max(scores, key=scores.get)

    results = {
        "design": "üé® –¢–µ–±–µ –ø–æ–¥–æ–π–¥—ë—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ *–î–∏–∑–∞–π–Ω*! –£ —Ç–µ–±—è –æ—Ç–ª–∏—á–Ω—ã–π –≤–∫—É—Å –∏ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ!",
        "it": "üíª –¢–µ–±–µ –ø–æ–¥–æ–π–¥—ë—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ *IT*! –¢—ã –ª–æ–≥–∏—á–Ω—ã–π, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–π –∏ –ª—é–±–∏—à—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏!",
        "psy": "üß† –¢–µ–±–µ –ø–æ–¥–æ–π–¥—ë—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ *–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è*! –¢—ã –ø–æ–Ω–∏–º–∞–µ—à—å –ª—é–¥–µ–π –∏ —É–º–µ–µ—à—å —Å–ª—É—à–∞—Ç—å!"
    }

    bot.send_message(chat_id, f"‚ú® –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!\n\n{results[best]}", parse_mode="Markdown")
    bot.send_message(chat_id, "–°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ! üåü", reply_markup=types.ReplyKeyboardRemove())
    del user_data[chat_id]

print("‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç...")
bot.polling(none_stop=True)
